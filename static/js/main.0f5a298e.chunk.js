(this["webpackJsonprandom-video-chat"]=this["webpackJsonprandom-video-chat"]||[]).push([[0],{13:function(e,n,t){},15:function(e,n,t){},17:function(e,n,t){"use strict";t.r(n);var a,r=t(0),c=t.n(r),o=t(5),i=t.n(o),s=(t(13),t(3)),u=t(2),l=t.n(u),d=t(6);function f(){return(f=Object(d.a)(l.a.mark((function e(n){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.getUserMedia({audio:!0,video:!0});case 2:t=e.sent,n.srcObject=t;case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return void 0!==e.getTracks}!function(e){e.USER_IS_READY="user_is_ready",e.USER_IS_NOT_READY="user_is_not_ready",e.READY_USERS_NUMBER="ready_users_number",e.NEXT="next",e.NEW_ICE_CANDIDATE="new_ice_candidate",e.VIDEO_OFFER="video_offer",e.VIDEO_ANSWER="video_answer"}(a||(a={}));t(15);var E=function(){var e=Object(r.useState)(!1),n=Object(s.a)(e,2),t=n[0],o=n[1],i=Object(r.useState)(null),u=Object(s.a)(i,2),l=u[0],d=u[1],E=Object(r.useRef)(null),_=Object(r.useRef)(null),m=Object(r.useRef)(null),p=Object(r.useRef)(null);Object(r.useEffect)((function(){!function(e){f.apply(this,arguments)}(E.current)}),[]);var O=Object(r.useCallback)((function(e){var n=JSON.parse(e.data);switch(console.log(n),n.type){case a.READY_USERS_NUMBER:d(n.payload);break;case a.VIDEO_OFFER:!function(e,n,t,r){var c=n.srcObject,o=new RTCSessionDescription(r);e.setRemoteDescription(o).then((function(){v(c)&&c.getTracks().forEach((function(n){return e.addTrack(n,c)}))})).then((function(){return e.createAnswer()})).then((function(n){return e.setLocalDescription(n)})).then((function(){t.send(JSON.stringify({type:a.VIDEO_ANSWER,payload:e.localDescription}))}))}(p.current,E.current,m.current,n.payload);break;case a.VIDEO_ANSWER:!function(e,n){var t=new RTCSessionDescription(n);e.setRemoteDescription(t)}(p.current,n.payload);break;case a.NEW_ICE_CANDIDATE:!function(e,n){var t=new RTCIceCandidate(e);n.addIceCandidate(t)}(n.payload,p.current)}}),[]),b=Object(r.useCallback)((function(){var e;null===(e=p.current)||void 0===e||e.createOffer().then((function(e){var n;return null===(n=p.current)||void 0===n?void 0:n.setLocalDescription(e)})).then((function(){var e,n;null===(e=m.current)||void 0===e||e.send(JSON.stringify({type:a.VIDEO_OFFER,payload:null===(n=p.current)||void 0===n?void 0:n.localDescription}))}))}),[]),N=Object(r.useCallback)((function(e){var n;e.candidate&&(null===(n=m.current)||void 0===n||n.send(JSON.stringify({type:a.NEW_ICE_CANDIDATE,payload:e.candidate})))}),[]),y=Object(r.useCallback)((function(e){_.current.srcObject=e.streams[0]}),[]),R=Object(r.useMemo)((function(){return{onMessage:O}}),[O]),h=Object(r.useMemo)((function(){return{handleNegotiationNeededEvent:b,handleICECandidateEvent:N,handleTrackEvent:y}}),[N,b,y]),S=Object(r.useCallback)((function(){var e=m.current;t?(null===e||void 0===e||e.send(JSON.stringify({type:a.USER_IS_NOT_READY})),o(!1)):(null===e||void 0===e||e.send(JSON.stringify({type:a.USER_IS_READY})),o(!0),Number(l)>0&&function(e,n){var t=n.srcObject;v(t)&&t.getTracks().forEach((function(n){return e.addTrack(n,t)}))}(p.current,E.current))}),[t,l]);return m.current=function(e){var n=e.onMessage,t=Object(r.useRef)(null);return Object(r.useEffect)((function(){t.current=new WebSocket("wss://evstar.ru:7000"),t.current.onmessage=n}),[n]),[t.current]}(R)[0],p.current=function(e){var n=e.handleNegotiationNeededEvent,t=e.handleICECandidateEvent,a=e.handleTrackEvent,c=Object(r.useRef)(null);return Object(r.useEffect)((function(){c.current=new RTCPeerConnection({iceServers:[{urls:"stune:stune.i.google.com:19302"},{urls:"turn:194.87.239.193:443",username:"evstarostin",credential:"jck30011989"}]}),c.current.onicecandidate=t,c.current.ontrack=a,c.current.onnegotiationneeded=n}),[t,n,a]),[c.current]}(h)[0],c.a.createElement("div",{className:"app"},c.a.createElement("div",{className:"app__column"},c.a.createElement("div",{className:"video"},c.a.createElement("div",{className:"video__attendance"},"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439 \u0432 \u043e\u0447\u0435\u0440\u0435\u0434\u0438: ",l),c.a.createElement("video",{className:"video__player",muted:!0,autoPlay:!0,playsInline:!0,ref:E},"\u0412\u0438\u0434\u0435\u043e \u043d\u0435 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044f \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u043e\u043c"))),c.a.createElement("div",{className:"app__column"},c.a.createElement("div",{className:"video"},c.a.createElement("video",{className:"video__player",autoPlay:!0,playsInline:!0,ref:_},"\u0412\u0438\u0434\u0435\u043e \u043d\u0435 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044f \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u043e\u043c"),c.a.createElement("div",{className:"video__footer"},c.a.createElement("button",{className:"video__ready",onClick:S},t?"\u0417\u0430\u043a\u043e\u043d\u0447\u0438\u0442\u044c":"\u041d\u0430\u0447\u0430\u0442\u044c")))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));t(16);i.a.render(c.a.createElement(c.a.StrictMode,null,c.a.createElement(E,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},8:function(e,n,t){e.exports=t(17)}},[[8,1,2]]]);
//# sourceMappingURL=main.0f5a298e.chunk.js.map