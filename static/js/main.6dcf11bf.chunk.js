(this["webpackJsonprandom-video-chat"]=this["webpackJsonprandom-video-chat"]||[]).push([[0],{13:function(e,t,n){},15:function(e,t,n){},17:function(e,t,n){"use strict";n.r(t);var r,a,c,o=n(0),u=n.n(o),s=n(6),i=n.n(s),l=(n(13),n(3)),d=n(1),p=n.n(d),f=n(4),v=[{urls:"stun:evstar.ru:3478",username:"evstarostin",credential:"jck30011989"},{urls:"turn:evstar.ru:3478",username:"evstarostin",credential:"jck30011989"}];function b(){return(b=Object(f.a)(p.a.mark((function e(t){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=null,e.prev=1,e.next=4,navigator.mediaDevices.getUserMedia({audio:!0,video:!0});case 4:return n=e.sent,t.srcObject=n,e.abrupt("return",Promise.resolve());case 9:return e.prev=9,e.t0=e.catch(1),e.abrupt("return",Promise.reject(e.t0));case 12:case"end":return e.stop()}}),e,null,[[1,9]])})))).apply(this,arguments)}function O(){return(O=Object(f.a)(p.a.mark((function e(t,n){var r,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.srcObject,a=j(n),E(r)){e.next=4;break}return e.abrupt("return");case 4:return e.prev=4,e.next=7,r.getTracks().forEach((function(e){return a.addTrack(e,r)}));case 7:return e.abrupt("return",Promise.resolve(a));case 10:return e.prev=10,e.t0=e.catch(4),e.abrupt("return",Promise.reject(e.t0));case 13:case"end":return e.stop()}}),e,null,[[4,10]])})))).apply(this,arguments)}function m(){return(m=Object(f.a)(p.a.mark((function e(t,n,a,c){var o,u,s,i;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(E(o=t.srcObject)){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,u=j(c),s=new RTCSessionDescription(a),e.next=8,u.setRemoteDescription(s);case 8:return o.getTracks().forEach((function(e){return u.addTrack(e,o)})),e.next=11,u.createAnswer();case 11:return i=e.sent,e.next=14,u.setLocalDescription(i);case 14:return n.send(JSON.stringify({type:r.VIDEO_ANSWER,payload:u.localDescription})),e.abrupt("return",Promise.resolve(u));case 18:return e.prev=18,e.t0=e.catch(3),e.abrupt("return",Promise.reject(e.t0));case 21:case"end":return e.stop()}}),e,null,[[3,18]])})))).apply(this,arguments)}function E(e){return void 0!==e.getTracks}function _(e,t){null===e||void 0===e||e.send(JSON.stringify(t))}function j(e){var t=new RTCPeerConnection({iceServers:v});return Object.assign(t,e),t}!function(e){e.NEW_ICE_CANDIDATE="[webrtc]: new_ice_candidate",e.VIDEO_OFFER="[webrtc]: video_offer",e.VIDEO_ANSWER="[webrtc]: video_answer"}(r||(r={})),function(e){e.READY="[client]: ready",e.NOT_READY="[client]: not_ready",e.CONNECTED="[client]: connected",e.NOT_CONNECTED="[client]: not_connected"}(a||(a={})),function(e){e.INFO="[server]: info",e.CALL="[server]: call",e.HANG_UP="[server]: hang_up"}(c||(c={}));n(15);var N=function(){var e=Object(o.useState)(!1),t=Object(l.a)(e,2),n=t[0],s=t[1],i=Object(o.useState)(!1),d=Object(l.a)(i,2),p=d[0],f=d[1],v=Object(o.useState)(!1),E=Object(l.a)(v,2),j=E[0],N=E[1],y=Object(o.useState)(!1),h=Object(l.a)(y,2),k=h[0],C=h[1],D=Object(o.useState)("\u041f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u043a \u0441\u0435\u0440\u0432\u0435\u0440\u0443 ..."),w=Object(l.a)(D,2),R=w[0],g=w[1],T=Object(o.useRef)(null),I=Object(o.useRef)(null),A=Object(o.useRef)(null),S=Object(o.useRef)(null);Object(o.useEffect)((function(){(function(e){return b.apply(this,arguments)})(T.current).then((function(){f(!0)})).catch((function(){f(!1)}))}),[]);var x=Object(o.useCallback)((function(){var e;null===(e=S.current)||void 0===e||e.close(),S.current=null,I.current.srcObject=null}),[]),P=Object(o.useCallback)((function(){var e;null===(e=S.current)||void 0===e||e.createOffer().then((function(e){var t;return null===(t=S.current)||void 0===t?void 0:t.setLocalDescription(e)})).then((function(){var e;_(A.current,{type:r.VIDEO_OFFER,payload:null===(e=S.current)||void 0===e?void 0:e.localDescription})}))}),[]),W=Object(o.useCallback)((function(e){e.candidate&&_(A.current,{type:r.NEW_ICE_CANDIDATE,payload:e.candidate})}),[]),F=Object(o.useCallback)((function(e){I.current.srcObject=e.streams[0],_(A.current,{type:a.CONNECTED}),C(!0)}),[]),L=Object(o.useMemo)((function(){return{onnegotiationneeded:P,onicecandidate:W,ontrack:F}}),[W,P,F]),M=Object(o.useCallback)((function(e){var t=JSON.parse(e.data);switch(console.log(t),t.type){case c.INFO:g("\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439: ".concat(t.payload.users," (\u0432 \u043e\u0436\u0438\u0434\u0430\u043d\u0438\u0438: ").concat(t.payload.readyUsers,", \u043d\u0430 \u0441\u0432\u044f\u0437\u0438: ").concat(t.payload.connectedUsers,")"));break;case c.CALL:(function(e,t){return O.apply(this,arguments)})(T.current,L).then((function(e){return S.current=e||null}));break;case c.HANG_UP:x(),C(!1);break;case r.VIDEO_OFFER:(function(e,t,n,r){return m.apply(this,arguments)})(T.current,A.current,t.payload,L).then((function(e){return S.current=e||null}));break;case r.VIDEO_ANSWER:!function(e,t){var n=new RTCSessionDescription(t);e.setRemoteDescription(n)}(S.current,t.payload);break;case r.NEW_ICE_CANDIDATE:!function(e,t){try{t&&t.addIceCandidate(new RTCIceCandidate(e))}catch(n){console.error(n)}}(t.payload,S.current)}}),[x,L]),V=Object(o.useCallback)((function(e){s(!0)}),[]),J=Object(o.useMemo)((function(){return{onMessage:M,onOpen:V}}),[M,V]);A.current=function(e){var t=e.onMessage,n=e.onOpen,r=Object(o.useRef)(null);return Object(o.useEffect)((function(){r.current=new WebSocket("wss://evstar.ru:7000"),r.current.onmessage=t,r.current.onopen=n}),[t,n]),[r.current]}(J)[0];var U=Object(o.useCallback)((function(){j?(_(A.current,{type:a.NOT_READY}),N(!1)):(_(A.current,{type:a.READY}),N(!0))}),[j]),Y=Object(o.useCallback)((function(){x(),_(A.current,{type:a.NOT_CONNECTED}),C(!1)}),[x]);return u.a.createElement("div",{className:"app"},u.a.createElement("div",{className:"app__column"},u.a.createElement("div",{className:"video"},u.a.createElement("div",{className:"video__info"},R),u.a.createElement("video",{className:"video__player",muted:!0,autoPlay:!0,playsInline:!0,ref:T},"\u0412\u0438\u0434\u0435\u043e \u043d\u0435 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044f \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u043e\u043c"))),u.a.createElement("div",{className:"app__column"},u.a.createElement("div",{className:"video"},u.a.createElement("video",{className:"video__player",autoPlay:!0,playsInline:!0,ref:I},"\u0412\u0438\u0434\u0435\u043e \u043d\u0435 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044f \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u043e\u043c"),!j&&n&&u.a.createElement("button",{className:"video__ready",onClick:U},u.a.createElement("div",{className:"video__ready-text"},"\u041d\u0430\u0447\u0430\u0442\u044c")),k&&u.a.createElement("button",{className:"video__next",onClick:Y},"\u0421\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0439"),j&&!k&&u.a.createElement("span",{className:"video__spinner"}))),!p&&u.a.createElement("h1",{className:"app__warning"},"\u041d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0434\u0430\u0442\u044c \u0434\u043e\u0441\u0442\u0443\u043f \u043a \u043a\u0430\u043c\u0435\u0440\u0435 \u0447\u0442\u043e\u0431\u044b \u0443\u0447\u0430\u0441\u0442\u0432\u043e\u0432\u0430\u0442\u044c"))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(16);i.a.render(u.a.createElement(u.a.StrictMode,null,u.a.createElement(N,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},8:function(e,t,n){e.exports=n(17)}},[[8,1,2]]]);
//# sourceMappingURL=main.6dcf11bf.chunk.js.map