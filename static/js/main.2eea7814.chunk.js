(this["webpackJsonprandom-video-chat"]=this["webpackJsonprandom-video-chat"]||[]).push([[0],{13:function(e,t,n){},15:function(e,t,n){},17:function(e,t,n){"use strict";n.r(t);var r,a,c,o=n(0),s=n.n(o),u=n(6),i=n.n(u),l=(n(13),n(3)),d=n(1),p=n.n(d),v=n(4),f=[{urls:"stun:194.87.239.193:3478",username:"evstarostin",credential:"jck30011989"},{urls:"turn:194.87.239.193:3478",username:"evstarostin",credential:"jck30011989"}];function b(){return(b=Object(v.a)(p.a.mark((function e(t){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=null,e.prev=1,e.next=4,navigator.mediaDevices.getUserMedia({audio:!0,video:!0});case 4:return n=e.sent,t.srcObject=n,e.abrupt("return",Promise.resolve());case 9:return e.prev=9,e.t0=e.catch(1),e.abrupt("return",Promise.reject(e.t0));case 12:case"end":return e.stop()}}),e,null,[[1,9]])})))).apply(this,arguments)}function m(){return(m=Object(v.a)(p.a.mark((function e(t,n){var r,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.srcObject,a=N(n),E(r)){e.next=4;break}return e.abrupt("return");case 4:return e.prev=4,e.next=7,r.getTracks().forEach((function(e){return a.addTrack(e,r)}));case 7:return e.abrupt("return",Promise.resolve(a));case 10:return e.prev=10,e.t0=e.catch(4),e.abrupt("return",Promise.reject(e.t0));case 13:case"end":return e.stop()}}),e,null,[[4,10]])})))).apply(this,arguments)}function O(){return(O=Object(v.a)(p.a.mark((function e(t,n,a,c){var o,s,u;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(E(o=t.srcObject)){e.next=3;break}return e.abrupt("return");case 3:if(s=N(c),u=new RTCSessionDescription(a),e.prev=5,"stable"===s.signalingState){e.next=12;break}return e.next=9,Promise.all([s.setLocalDescription({type:"rollback"}),s.setRemoteDescription(u)]);case 9:return e.abrupt("return",Promise.resolve(s));case 12:return e.next=14,s.setRemoteDescription(u);case 14:return o.getTracks().forEach((function(e){return s.addTrack(e,o)})),e.t0=s,e.next=18,s.createAnswer();case 18:return e.t1=e.sent,e.next=21,e.t0.setLocalDescription.call(e.t0,e.t1);case 21:return n.send(JSON.stringify({type:r.VIDEO_ANSWER,payload:s.localDescription})),e.abrupt("return",Promise.resolve(s));case 25:return e.prev=25,e.t2=e.catch(5),e.abrupt("return",Promise.reject(e.t2));case 28:case"end":return e.stop()}}),e,null,[[5,25]])})))).apply(this,arguments)}function E(e){return void 0!==e.getTracks}function _(e,t){null===e||void 0===e||e.send(JSON.stringify(t))}function N(e){var t=new RTCPeerConnection({iceServers:f});return Object.assign(t,e),t}!function(e){e.NEW_ICE_CANDIDATE="[webrtc]: new_ice_candidate",e.VIDEO_OFFER="[webrtc]: video_offer",e.VIDEO_ANSWER="[webrtc]: video_answer"}(r||(r={})),function(e){e.READY="[client]: ready",e.NOT_READY="[client]: not_ready",e.CONNECTED="[client]: connected",e.NOT_CONNECTED="[client]: not_connected"}(a||(a={})),function(e){e.INFO="[server]: info",e.CALL="[server]: call",e.HANG_UP="[server]: hang_up"}(c||(c={}));n(15);var j=function(){var e=Object(o.useState)(!1),t=Object(l.a)(e,2),n=t[0],u=t[1],i=Object(o.useState)(!1),d=Object(l.a)(i,2),p=d[0],v=d[1],f=Object(o.useState)(!1),E=Object(l.a)(f,2),N=E[0],j=E[1],y=Object(o.useState)(!1),h=Object(l.a)(y,2),k=h[0],C=h[1],D=Object(o.useState)("\u041f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0435 \u043a \u0441\u0435\u0440\u0432\u0435\u0440\u0443 ..."),w=Object(l.a)(D,2),g=w[0],R=w[1],T=Object(o.useRef)(null),I=Object(o.useRef)(null),A=Object(o.useRef)(null),S=Object(o.useRef)(null);Object(o.useEffect)((function(){(function(e){return b.apply(this,arguments)})(T.current).then((function(){v(!0)})).catch((function(){v(!1)}))}),[]);var x=Object(o.useCallback)((function(){var e;null===(e=S.current)||void 0===e||e.close(),S.current=null}),[]),P=Object(o.useCallback)((function(){var e,t;"stable"===(null===(e=S.current)||void 0===e?void 0:e.signalingState)&&(null===(t=S.current)||void 0===t||t.createOffer().then((function(e){var t;return null===(t=S.current)||void 0===t?void 0:t.setLocalDescription(e)})).then((function(){var e;_(A.current,{type:r.VIDEO_OFFER,payload:null===(e=S.current)||void 0===e?void 0:e.localDescription})})))}),[]),W=Object(o.useCallback)((function(e){e.candidate&&_(A.current,{type:r.NEW_ICE_CANDIDATE,payload:e.candidate})}),[]),F=Object(o.useCallback)((function(e){I.current.srcObject=e.streams[0],_(A.current,{type:a.CONNECTED}),C(!0)}),[]),L=Object(o.useMemo)((function(){return{onnegotiationneeded:P,onicecandidate:W,ontrack:F}}),[W,P,F]),M=Object(o.useCallback)((function(e){var t=JSON.parse(e.data);switch(console.log(t),t.type){case c.INFO:R("\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439: ".concat(t.payload.users," (\u0432 \u043e\u0436\u0438\u0434\u0430\u043d\u0438\u0438: ").concat(t.payload.readyUsers,", \u043d\u0430 \u0441\u0432\u044f\u0437\u0438: ").concat(t.payload.connectedUsers,")"));break;case c.CALL:(function(e,t){return m.apply(this,arguments)})(T.current,L).then((function(e){return S.current=e||null}));break;case c.HANG_UP:x(),C(!1);break;case r.VIDEO_OFFER:(function(e,t,n,r){return O.apply(this,arguments)})(T.current,A.current,t.payload,L).then((function(e){return S.current=e||null}));break;case r.VIDEO_ANSWER:!function(e,t){var n=new RTCSessionDescription(t);e.setRemoteDescription(n)}(S.current,t.payload);break;case r.NEW_ICE_CANDIDATE:!function(e,t){var n=new RTCIceCandidate(e);try{t.addIceCandidate(n)}catch(r){}}(t.payload,S.current)}}),[L]),V=Object(o.useCallback)((function(e){u(!0)}),[]),J=Object(o.useMemo)((function(){return{onMessage:M,onOpen:V}}),[M,V]);A.current=function(e){var t=e.onMessage,n=e.onOpen,r=Object(o.useRef)(null);return Object(o.useEffect)((function(){r.current=new WebSocket("wss://evstar.ru:7000"),r.current.onmessage=t,r.current.onopen=n}),[t,n]),[r.current]}(J)[0];var U=Object(o.useCallback)((function(){N?(_(A.current,{type:a.NOT_READY}),j(!1)):(_(A.current,{type:a.READY}),j(!0))}),[N]),Y=Object(o.useCallback)((function(){x(),_(A.current,{type:a.NOT_CONNECTED}),C(!1)}),[x]);return s.a.createElement("div",{className:"app"},s.a.createElement("div",{className:"app__column"},s.a.createElement("div",{className:"video"},s.a.createElement("div",{className:"video__info"},g),s.a.createElement("video",{className:"video__player",muted:!0,autoPlay:!0,playsInline:!0,ref:T},"\u0412\u0438\u0434\u0435\u043e \u043d\u0435 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044f \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u043e\u043c"))),s.a.createElement("div",{className:"app__column"},s.a.createElement("div",{className:"video"},s.a.createElement("video",{className:"video__player",autoPlay:!0,playsInline:!0,ref:I},"\u0412\u0438\u0434\u0435\u043e \u043d\u0435 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044f \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u043e\u043c"),!N&&n&&s.a.createElement("button",{className:"video__ready",onClick:U},s.a.createElement("div",{className:"video__ready-text"},"\u041d\u0430\u0447\u0430\u0442\u044c")),k&&s.a.createElement("button",{className:"video__next",onClick:Y},"\u0421\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0439"),N&&!k&&s.a.createElement("span",{className:"video__spinner"}))),!p&&s.a.createElement("h1",{className:"app__warning"},"\u041d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0434\u0430\u0442\u044c \u0434\u043e\u0441\u0442\u0443\u043f \u043a \u043a\u0430\u043c\u0435\u0440\u0435 \u0447\u0442\u043e\u0431\u044b \u0443\u0447\u0430\u0441\u0442\u0432\u043e\u0432\u0430\u0442\u044c"))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(16);i.a.render(s.a.createElement(s.a.StrictMode,null,s.a.createElement(j,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},8:function(e,t,n){e.exports=n(17)}},[[8,1,2]]]);
//# sourceMappingURL=main.2eea7814.chunk.js.map